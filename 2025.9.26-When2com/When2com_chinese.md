
# When2com：通过通信图分组实现的多智能体感知  
Yen-Cheng Liu, Junjiao Tian∗, Nathaniel Glaser∗, Zsolt Kira  
Georgia Institute of Technology  
{ycliu, jtian73, nglaser3, zkira}@gatech.edu

**摘要**

尽管单智能体感知取得了显著进展，但许多应用场景需要多个传感智能体以及跨智能体通信，这样做的好处包括更大的覆盖范围和更强的鲁棒性。因此，有必要开发在分布式且带宽高效的方式下支持多智能体协同感知的框架。本文研究协作感知问题，其中某一智能体需要执行感知任务，并且可以与其他参与相同任务的智能体进行通信和信息共享。具体而言，我们提出了一个通信框架，通过学习来同时构建通信组并决定何时通信。我们在两个不同的感知任务上展示了该框架的泛化能力，并证明其在显著降低通信带宽的同时，仍能保持优越的性能。

---

## 1. 引言

在单智能体感知与识别方面已经取得了显著进展，研究者利用一种或多种传感模态来执行目标检测[30,31,22]、语义分割[3,12,19]、深度估计[10,38,11]以及各种场景理解任务。然而，在许多应用中（例如机器人领域），环境中可能分布着多个智能体，每个智能体都有其本地传感器。这样的多智能体系统在许多情况下具有优势，例如可以增加对环境的覆盖或提高对故障的鲁棒性。

因此，我们研究多智能体协作感知问题——这是文献中较少涉猎的方向，其中多个智能体能够交换信息以提高针对感知任务（例如语义分割或目标识别）的整体准确率。多智能体协作感知面临的一个主要挑战是传输带宽，高带宽会导致网络拥塞以及智能体网络中的延迟。因此，我们研究一种场景：各智能体（及其传感器）之间的信息不是集中可得的，智能体只能通过带宽受限的通道进行通信。我们还考虑了一些具有挑战性的情形，其中部分传感数据可能是无信息量或已被退化。

先前关于学习通信的工作[34,8]主要关注决策制定任务（而不是为了提高感知），并且通常是在简单的感知环境下研究。此外，这些方法也没有考虑带宽限制：它们学习在一个**完全连通图**上通信（即所有智能体通过广播两两通信）。当智能体数量增加时，这类方法难以扩展。同样，由于所有信息都被广播，系统中没有基于需求的“何时通信”的决策。当本地观测已经能够完成预测时，智能体无需消耗带宽。如果其他智能体发送的消息被退化或与当前任务无关，则通信可能对感知任务产生负面影响。

本文提出了一种用于协作感知的基于学习的通信模型。我们将问题视为学习如何**构建通信组**（即每个智能体决定发送什么以及与哪些智能体通信）以及学习**何时通信**，并且在训练时并不需要这些决策的显式监督。与基于广播的方法（例如 TarMac [6]）不同，并受通用注意力机制启发，我们的方法把通信阶段解耦，从而允许**消息与键的大小不对称**，降低传输数据量。

我们的方法可以推广到若干下游视觉任务，包括多智能体协作语义分割（密集预测）和多智能体 3D 形状识别（全局预测）。我们的模型可以在只利用下游任务监督（例如分割的真实掩码或图像识别的类别标签）并无显式通信标签的情况下进行端到端训练。

我们在不同任务上展示了该方法在使用更少带宽情况下，相较先前学习通信的工作具有竞争力的性能。我们进行了详尽的分析，包括消息与查询大小之间的权衡、真实键与预测消息之间的相关性，以及学习到的通信组的可视化。

我们的贡献如下：

- 我们研究了协作感知这个交叉领域（感知、多智能体系统与通信），这是一个尚未充分探索的方向。
- 我们提出了一个统一框架，能够学习如何构建通信组以及何时通信；该框架在训练时不需要真实的通信标签，并能在推理时动态减少带宽。
- 我们的方法可以推广到多种下游任务，并在严格实验中表现优于之前的学习通信方法。
- 我们提供了一个协作多智能体语义分割数据集 AirSim-MAP，其中每个智能体拥有自己的深度图、位姿、RGB 图像和语义分割掩码，便于进一步研究多智能体感知的解决方案。

---

## 2. 相关工作

**学习通信。** 通信对于有效协作（尤其是多智能体决策与感知任务）是至关重要的。早期的工作[35,27]通过预定义的通信协议促进信息流与协作。类似地，用于摄像头分组的拍卖方法[21,29]使用若干假设（例如摄像头静止）和启发式规则来决定智能体之间的通信。但这些刚性协议无法随动态环境演化，也难以推广到复杂环境。

因此，近年来若干多智能体强化学习（MARL）工作探索了可学习的智能体间交互。例如在 CommNet[34] 中，假设智能体间完全合作，每个智能体广播其隐藏状态到一个共享通信通道，其他智能体基于该综合信息决定其动作。Foerster 等人[8]提出了基于学习的离散信号通信方案。为进一步利用智能体间互动，Battaglia 等人[2] 与 Hoshen[15] 在 CommNet 中引入核函数。此外，若干工作通过递归神经网络（RNN）处理通信问题，如 DIAL[7] 使用 RNN 来基于观测和来自其他智能体的消息推导每个智能体的 Q 值。BiCNet[28] 用双向 LSTM 连接所有智能体以集成智能体特有信息，ATOC[18] 则加入注意力单元来决定广播哪些信息。尽管这些 MARL 工作取得了实质性进展，但大多数实验任务都建立在简单的二维网格环境上，智能体观察到的是低维的二维图像。正如 Jain 等人[16] 指出，在简化环境中研究智能体交互，无法充分探讨感知与通信之间的相互作用。

最近一些工作试图基于预定义规则构建通信组[18,17]，或者使用统一的通信网络[33,34,15,28,33,6]。这些技术在智能体数量扩大时，会导致通信带宽随之增加。虽然 Who2com[23] 使用握手式通信以减少带宽，但该模型假设所有智能体总是需要与其它某个智能体通信。这会浪费带宽，且无法避免来自不相关或退化消息的负面影响。相比之下，我们提出的框架通过学习**何时通信**和**如何创建通信组**来缓解这些问题。

**注意力机制。** 注意力机制已被广泛应用于近期的学习模型中。简言之，注意力机制可以被视为一种软融合策略，根据查询（query）与键（key）之间的相似度为不同的值加权。常见的注意力机制包括加性注意力[1]、缩放点积注意力[36]以及通用注意力[25]。我们的一个关键发现是：通用注意力机制允许查询与键大小不对称，因此特别适合带宽敏感的任务：智能体传输的查询消息可以比保留的键更小，从而降低总体带宽消耗。

---

## 3. 方法

我们提出模型的目标是解决多智能体协作感知问题，其中某个智能体可以通过接收其他智能体的信息来提升其感知表现。本文特别关注以带宽受限的方式**学习构建通信组**以及**学习何时通信**。

### 3.1 问题定义与符号

我们假设环境包含 $N$ 个智能体，它们各自有自己的观测 $X = \{x_n\}_{n=1,\dots,N}$。其中有些智能体的观测是退化的 $\tilde{X} = \{\tilde{x}_\ell\}_{\ell=1,\dots,L}$，退化智能体集合是所有智能体的子集 $\tilde{X} \subset X$。每个智能体在所提出的通信机制下输出感知任务的预测 $\tilde{Y} = \{\tilde{y}_n\}_{n=1,\dots,N}$。注意每个智能体同时是请求方（requester）和支持方（supporter），但哪些智能体被退化在我们的设置中是未知的。

### 3.2 通信组的构建

如图 2 所示，先前关于学习通信的工作通常采用**全连通**通信来在智能体间交换信息。这种框架会产生大量带宽使用，并且当智能体数量增加时难以扩展。

为减少网络复杂度和带宽使用，我们受通信网络协议[20]的启发，提出了两步的组构建流程：首先使用握手通信（handshake communication）来确定连接权重，然后使用激活函数进一步剪枝不重要的连接。

要开始构建通信组，我们应用三阶段的握手通信机制[23]，该机制包含请求（request）、匹配（match）和选择（select）三个阶段。智能体 $i$ 首先将其本地观测 $x_i$ 压缩成一个紧凑的查询向量 $\mu_i$ 和一个键向量 $\kappa_i$:

$$
\mu_i = G_q(x_i; \theta_q) \in \mathbb{R}^Q,\quad \kappa_i = G_k(x_i; \theta_k) \in \mathbb{R}^K,
$$

其中 $G_q$ 是参数为 $\theta_q$ 的查询生成器，$G_k$ 是参数为 $\theta_k$ 的键生成器。我们将查询广播给所有其它智能体，注意所有查询与高分辨率图像相比非常紧凑，因此只造成有限量的带宽传输。为决定与谁通信，我们计算请求方智能体 $i$ 与支持方智能体 $j$ 之间的匹配分数 $m_{i,j}$：

$$
m_{i,j} = \Phi(\mu_i, \kappa_j),\quad \forall i \ne j,
$$

其中 $\Phi(\cdot,\cdot)$ 是一个学习到的相似性函数，用以度量两个向量之间的相关性。匹配分数 $m_{i,j}$ 表示智能体 $i$ 与 $j$ 之间的相关性，直观上也代表支持者 $j$ 能为请求者 $i$ 提供的信息量。

然而，上述方法并未学习“何时通信”，当智能体已有足够信息时仍会浪费带宽。理想的通信机制应当在智能体需要额外信息以提升感知能力时开启传输，而在本地信息已足够时关闭传输。为此，我们受自注意力机制[4]启发，使用同一智能体的键与查询之间的关联来判断该智能体是否可能需要更多信息，从而学习何时通信：

$$
m_{i,i} = \Phi(\mu_i, \kappa_i).
$$

注意 $m_{i,i} \approx 1$ 表示该智能体拥有足够信息而无需通信来完成感知任务。

为了在传输过程中最小化带宽使用，我们进一步提出**非对称消息**方法，即将查询压缩为极低维（用于传输），而保持更大的键向量（不传输）。一旦极紧凑的查询被传递到接收方，我们使用缩放的通用注意力[25,36]来计算智能体 $i$ 与 $j$ 之间的相关性：

$$
\Phi(\mu_i, \kappa_j) = \frac{\mu_i^\top W_g \kappa_j}{\sqrt{K}},
$$

其中 $W_g \in \mathbb{R}^{Q \times K}$ 是可学习参数，用于匹配查询与键的维度，$Q$ 和 $K$ 分别是查询与键的维数。

基于上述跨所有查询与键的自注意力与交叉注意力机制，我们得到匹配矩阵 $M$：

$$
M = \sigma\left(\begin{pmatrix}
m_{1,1} & m_{1,2} & \cdots & m_{1,N} \\
m_{2,1} & m_{2,2} & \cdots & m_{2,N} \\
\vdots & \vdots & \ddots & \vdots \\
m_{N,1} & m_{N,2} & \cdots & m_{N,N}
\end{pmatrix}\right) \in \mathbb{R}^{N\times N},
$$

其中 $\sigma(\cdot)$ 是按行的 softmax 函数。

为了构造通信组，我们用激活函数剪枝不重要的连接：

$$
\bar{M} = \Gamma(M; \delta),
$$

其中 $\Gamma(\cdot; \delta)$ 是按元素操作的函数，会将小于阈值 $\delta$ 的元素置零。（在我们的实验中设置 $\delta = 1/N$）。

所得矩阵 $\bar{M}$ 可视为有向图的邻接矩阵，其元素表示何时通信，元素为零表示不与之通信，如图 4 所示。矩阵的每一行代表接收方如何从不同支持者处收集信息，每一列表示某一支持者如何向不同请求者发送信息。

如图 3 所示，一旦请求方收集到来自其连接的支持者的信息，请求方 $i$ 将基于匹配分数整合其本地观测和来自支持者的压缩可视化特征图：

$$
\hat{y}_i = D([f_i; f^{\text{int}}_i]; \theta_d),\quad 
f^{\text{int}}_i = \sum_{j=1:\ \bar{m}_{i,j} \ne 0}^{N} \bar{m}_{i,j} f_j,
$$

其中 $D$ 是参数为 $\theta_d$ 的下游感知任务解码器，$\bar{m}_{i,j}$ 是矩阵 $\bar{M}$ 的第 $i$ 行第 $j$ 列元素，$f_i = E(x_i; \theta_e)$ 是图像编码器 $E$ 对智能体 $i$ 的观测 $x_i$ 提取的特征图，$[;]$ 表示按通道维度拼接。值得注意的是，我们的感知任务解码器并不限于特定视觉任务，我们将在实验中展示通信框架可泛化到不同视觉任务。

### 3.3 通信的学习

我们的学习策略遵循“集中式训练、分散式推理”（centralized training and decentralized inference）的流程[24]。即在训练阶段，所有智能体都可以访问所有智能体的本地观测；而在推理阶段，每个智能体只能看到其自身的本地观测。我们的目标是学习一种带宽高效的通信机制，使得在推理阶段模型能够以带宽受限且分布式的方式执行多智能体协作感知。

我们依据前述握手通信计算匹配矩阵 $M$，并基于 $M$ 对智能体的特征图加权并进一步整合：

$$
f^{\text{all}}_i = \sum_{j=1}^{N} \tilde{m}_{i,j} f_j,
$$

其中 $\tilde{m}_{i,j}$ 是矩阵 $M$ 的第 $i$ 行第 $j$ 列元素。注意在上述表达式中 $m_{i,j} f_j$ 代表了“与谁通信”，而 $m_{i,i} f_i$ 表示“何时通信”。随后客户端智能体 $i$ 将其自身特征图 $f_i$ 与整合特征 $f^{\text{all}}_i$ 结合以计算下游视觉任务的预测：

$$
\tilde{y}_i = D([f_i; f^{\text{all}}_i]; \theta_d).
$$

为了训练我们的模型，我们使用下游任务（例如分割掩码）的标签作为监督，计算损失为：

$$
\mathcal{L} = H(y_j, \tilde{y}_j),
$$

其中 $H(\cdot,\cdot)$ 可以是任何下游视觉任务的目标函数（例如分割任务的逐像素交叉熵或识别任务的交叉熵）。随后我们以端到端方式更新模型参数 $\Theta=(\theta_k,\theta_q,\theta_e,\theta_d)$。

---

## 4. 实验

我们在两个不同的感知任务上评估所提出框架的性能：协作语义分割和多视角 3D 形状识别。

### 4.1 实验案例与数据集

#### 4.1.1 协作语义分割

第一个任务是 3D 场景的协作二维语义分割。给定来自若干移动智能体的观测（RGB 图像、对齐的稠密深度图和位姿），该任务的目标是为每个智能体生成准确的二维语义分割掩码。

由于现有的语义分割数据集[9,5,26,14] 仅提供来自单一视角的 RGB 图像与标签，我们使用 AirSim 仿真器[32] 收集了 AirSim-MAP（Multi-Agent Perception）数据集。对于该数据集，我们让 5 到 6 架无人机以不同偏航速率通过 AirSim “CityEnviron” 环境中的一系列航点。我们为每个智能体记录其位姿、深度图和 RGB 图像，并为所有无人机提供语义分割掩码。

我们在该任务中考虑三种实验情况。我们将尝试分割的智能体称为请求方，其它所有智能体称为支持方。各情况的细节如下：

- **Single-Request Multiple-Support (SRMS)**：该情况考察在单一请求方的场景下通信的有效性，假设当某一智能体被退化时，它的原始非退化信息会出现在某个支持方中。我们包含 5 个智能体，其中仅有一个可能被退化。我们对该智能体的 50% 随机帧加入噪声，并从其余智能体中随机替换出一帧为原始智能体的非退化帧。注意训练监督仅使用原始智能体的分割掩码。
- **Multiple-Request Multiple-Support (MRMS)**：第二种情况考虑更具挑战性的问题，即多个智能体可能遭受退化。该情况要求对所有智能体（退化与非退化）都给出分割输出。我们沿用前述设置，并确保每个退化的请求智能体在其支持方中存在相应的非退化图像。
- **Multiple-Request Multiple-Partial-Support (MRMPS)**：第三种情况移除了支持方中存在完全干净视图的假设。退化的智能体必须从其它智能体中选择最有信息量的视图，这些视图可能与请求视角部分重叠且相关度不一。具体地，当无人机群穿行于环境中时，每架无人机的图像会与其它无人机的图像周期性地并部分重叠。直观上，请求无人机的分割输出仅由那些具有视图重叠的支持无人机提供帮助。

#### 4.1.2 多智能体 3D 形状分类

除了语义分割任务，我们还考虑多智能体 3D 形状分类任务。为此我们构造了 ModelNet40 数据集[37] 的多智能体变体。原始数据集包含 40 类常见物体类别、每类约 100 个 CAD 模型，每个模型有 12 个不同视角。我们的变体在原始数据上加入了通信组结构：具体地，我们采样三组基于类别的图像三元组。每个三元组对应一个随机选择的 3D 对象模型，且三元组包含其对应对象模型的三个随机 2D 视角。为增加难度，我们进一步退化每个三元组中的一张图像。该任务的目标是通过利用所有智能体的信息为每个智能体预测对应的对象类别。图 6 展示了 9 个智能体的一次试验示例。该修改后的任务本质上是多视角分类任务的分布式版本[37]。

### 4.2 基线方法与评估指标

我们考虑若干完全连通（FC）和分布式通信（DistCom）模型作为基线。FC 模型融合所有智能体的观测（无论是否加权），而 DistCom 模型仅融合部分观测。

- **CatAll (FC)**：一个朴素的 FC 基线，将所有智能体编码后的图像特征在后续网络阶段前进行拼接。
- **Auxiliary-View Attention (AuxAttend; FC)**：使用注意力机制对支持方的辅助视图加权。
- **RandCom (DistCom)**：随机选择其它智能体之一作为支持方的朴素分布式基线。
- **Who2com [23] (DistCom)**：排除了自注意力机制，因此总是与某个支持方通信。
- **OccDeg and AllNorm**：不使用通信的基线。OccDeg 表示数据被退化的情形，AllNorm 表示所有视图均为干净图像。这两者分别作为下限和上限参考。

我们还把 CommNet[34]、VAIN[15]、TarMac[6] 的通信模块作为其它基线方法用于所有多输出任务。为公平比较，我们对本方法与所有提到的基线都使用 ResNet18[13] 作为特征骨干网络。对于 3D 识别任务，我们还加入 MVCNN[37] 作为基线。

我们用分割任务的平均交并比（mIoU）与 3D 识别任务的预测准确率评估模型性能。此外，我们以每帧兆字节（MBpf）报告带宽用于衡量 FC 与 DistCom 模型的带宽消耗。计算 MBpf 时，我们将需要传输给请求方的特征向量大小与广播给所有支持方的键的大小相加，并乘以存储所需的字节数。

### 4.3 定量结果

**Single-Request Multiple-Support (SRMS)**

该实验旨在检验模型是否能学会何时通信以及应与谁通信以帮助单一请求方。图 5 展示了我们模型与若干基线模型的表现。尽管大多数完全连通方法在预测 mIoU 上相较 NoCom 有提升，但它们需要以全连通的方式传播所有信息，因此带宽消耗很高。相比之下，我们的模型在预测准确率上更高，同时带宽使用更小（Who2com [23]：2 MBpf；本方法：0.98 MBpf）。另一个观察是，我们的模型相比 Who2com 进一步提升了性能，这表明学习**何时通信**的能力减少了带宽浪费并避免了当请求方信息足够时收到有害消息的情况。

**Multiple-Request Multiple-Support (MRMS)**

在该情形中，多个智能体同时被退化，每个智能体应该 (1) 识别何时需要通信，(2) 在需要时决定与谁通信，且 (3) 避免从支持方选择噪声视图。表 1 列出了相关实验结果。可以看出，当请求方无法避免选择噪声支持方时，CatAll 与 RandCom 的表现甚至比 NoCom 更差。这验证了我们的直觉：支持方的信息并不总是对请求方有益，错误信息的选择可能反而阻碍请求方的预测。

采用注意力机制对来自支持方的特征图加权后，AuxAttend 与 Who2com[23] 能够防止不正确视图恶化性能，并因此相较 NoCom、CatAll、RandCom 有所提升。然而，由于它们未学习**何时通信**，这些模型被迫总是向至少一个支持方请求信息，导致性能下降与不必要的带宽使用。

我们还比较了 CommNet[34] 与 TarMac[6]。尽管 CommNet 通过平均池化融合其它智能体的信息，但因为其无差别地包含所有视图，故并不能提升退化或未退化请求方的预测性能。另一方面，TarMac[6] 的结果优于一些基线，但其单向通信方式导致带宽开销大，在实际场景中难以应用。相比之下，我们方法在退化与非退化样本上均优于 TarMac，同时通过非对称查询机制并借助激活函数剪枝冗余连接，从而消耗更少带宽。

**Multiple-Request Multiple-Partial-Support (MRMPS)**

在此情形中，不同智能体间完全重叠观察的概率更低，因而预测时仅可利用不完整信息。表 1 的右边部分显示，在该场景下，所有 FC 与 DistCom 模型相较 NoCom 的性能提升较小（相比之前情形）。尽管如此，所有方法表现出与之前类似的趋势。我们的模型仍能维持与全连通模型相近的预测准确率，但仅用四分之一的带宽进行通信，这展现了本方法在带宽效率上的优越性。

**多智能体 3D 形状识别**

为展示模型的泛化能力，我们将模型应用于多智能体 3D 形状分类任务。表 2 给出了本方法与其它基线在该任务上的定量评估。我们的模型在退化分割上的准确率（80.72%）优于大多数基线，并且仅使用大约八分之一的带宽。图 6 给出了定性结果，展示智能体如何与正确且具有信息量的其它智能体通信。

### 4.4 分析

为探究模型相较基线改进的来源，我们在 SRMS 数据集上计算了两个选择准确率指标：**WhenToCom**（衡量在何时以及是否建立请求者与支持者之间的通信）和 **Grouping**（衡量在确实建立通信时是否创建了正确的通信组）。此外，我们还通过在 3D 识别数据集上控制查询与键的大小来讨论带宽与通信性能之间的权衡。

**握手通信的效果** 如图 8 所示，我们对提出的握手通信模块进行了消融研究。在 **Ours (w/o H-Com)** 模型中，我们移除了握手通信模块，使得每个智能体仅使用其本地观测来计算（1）通信分数和（2）通信组。我们同时给出了 RandCom 的结果。观察到我们带有握手通信的模型相比 RandCom 与不带握手通信的模型有显著提升。这表明握手通信对于判断何时通信以及应与谁通信是必要的：没有通信的智能体无法判断自己需要哪些信息以及哪些支持者持有相关信息来提升感知任务的表现。

图 6 可视化了 3D 识别任务的三个示例。每个智能体基于支持者和自身观测给出的信息，清楚地知道何时需要通信。例如，在前三个盒子示例中：左侧被退化的智能体会选择其它智能体中信息量丰富的视图；中间的非退化智能体会选择一个更有信息量的视图，尽管它已拥有一定信息；第三个智能体则判断无需通信，因为它拥有在所有视图中最有信息量的视角。值得一提的是，所有 9 个视图都提供给每个智能体，智能体需基于匹配分数识别出信息视图与有害视图。

**查询和键的尺寸** 我们进一步分析查询与键大小对分组准确率和分类准确率的影响（在 3D 形状分类任务上）。我们在固定键维度为 16 的情况下，将查询维度从 1 到 128 进行变化（见图 7）。观察到随着消息大小的增加，选择与分类准确率均有所提升。我们的模型在消息维度为 4 时已能较好运行。键大小亦呈现相同趋势。最显著的是我们发现查询与键的维度存在非对称性：当查询维度约为 16 时，选择准确率达到饱和，而键维度增加到 1024 时，选择准确率仍持续提升。我们的模型利用该非对称性在节省通信带宽的同时维持高性能。

---

## 5. 结论

本文提出了一个通用且带宽高效的协作感知通信框架。该框架学习如何构建通信组以及何时通信，并可推广到若干下游任务（包括但不限于多智能体语义分割与多智能体 3D 形状识别）。我们在多个比较方法上展示了在更低带宽需求下仍取得优异性能的能力。

